##todo

link profile max tokens with window size, duh.
log sys mess user mess also for each.
ensure state update for all changes
